<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Game.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Gremlins</a> &gt; <a href="index.source.html" class="el_package">gremlins</a> &gt; <span class="el_source">Game.java</span></div><h1>Game.java</h1><pre class="source lang-java linenums">package gremlins;

import processing.core.*;
import processing.data.*;

import java.io.*;
import java.util.*;
import java.lang.*;

public class Game{
    /*
    SECTION 1: DECLARATION AND INITIALIZATION OF CLASS ATTRIBUTES
        AND GAME PARAMETERS.
    */
    JSONObject game_config;
    JSONArray levels_config;

    private ArrayList&lt;Stonewall&gt; stonewalls;
    private ArrayList&lt;Brickwall&gt; brickwalls;
    private ArrayList&lt;Gremlin&gt; gremlins;
    private ArrayList&lt;Fireball&gt; fireballs;
    private ArrayList&lt;Slime&gt; slimes;
    private ArrayList&lt;Teleportal&gt; portals;
    private Wizard wizard;
    private Door door;
    private ArrayList&lt;Sprite&gt; walls;
    private Powerup powerup;

    private PImage rep_stonewall;
    private PImage[] rep_brickwall_stages;
    private PImage rep_gremlin;
    private PImage rep_fireball;
    private PImage rep_slime;
    private PImage[] rep_wizard_directions;
    private PImage rep_door;
    private PImage rep_powerup;
    private PImage[] rep_portal_status;

    private int current_level;

    private int current_key_pressed;

    private int player_speed;
    private int gremlin_speed;

<span class="fc" id="L46">    private int player_cooldown_counter = 0;</span>
    private int player_cooldown_frames;

    private int powerup_spawn_counter;
    private int powerup_counter;
    private int powerup_duration;

<span class="fc" id="L53">    private int portal_effect_counter = 0;</span>

    private int gremlin_cooldown_frames;
    private int initial_number_of_gremlins;

    private int lives;

<span class="fc" id="L60">    private boolean won = false;</span>

<span class="fc" id="L62">    private int end_screen_counter = 0;</span>

    /*
    SECTION 2: CONSTRUCTOR
    */
    public Game(JSONObject game_config, PImage stonewall, PImage[] brickwall_stages, PImage gremlin, PImage[] wizard_directions, 
<span class="fc" id="L68">     PImage door, PImage fireball, PImage slime, PImage powerup, PImage[] portal_status){</span>
        /*
        NOTE:
            - This is the only constructor because we want to make sure 
            all the sprite's representations are set up properly in one go.
         */
<span class="fc" id="L74">        this.stonewalls = new ArrayList&lt;Stonewall&gt;();</span>
<span class="fc" id="L75">        this.brickwalls = new ArrayList&lt;Brickwall&gt;();</span>
<span class="fc" id="L76">        this.gremlins = new ArrayList&lt;Gremlin&gt;();</span>
<span class="fc" id="L77">        this.fireballs = new ArrayList&lt;Fireball&gt;();</span>
<span class="fc" id="L78">        this.slimes = new ArrayList&lt;Slime&gt;();</span>
<span class="fc" id="L79">        this.portals = new ArrayList&lt;Teleportal&gt;();</span>
<span class="fc" id="L80">        this.wizard = new Wizard();</span>
<span class="fc" id="L81">        this.door = new Door();</span>
        /*
        NOTE:
            - Assigning the configuration as an attribute of the Game class
            so we don't have to pass it in again later.
         */
<span class="fc" id="L87">        this.game_config = game_config;</span>
<span class="fc" id="L88">        this.levels_config = game_config.getJSONArray(&quot;levels&quot;);</span>
<span class="fc" id="L89">        this.lives = game_config.getInt(&quot;lives&quot;);</span>

<span class="fc" id="L91">        this.current_level = 0;</span>

        /*
        NOTE:
            - Similarly, we don't want to pass the values
            in again and again.
         */
<span class="fc" id="L98">        this.rep_stonewall = stonewall;</span>
<span class="fc" id="L99">        this.rep_brickwall_stages = brickwall_stages;</span>
<span class="fc" id="L100">        this.rep_gremlin = gremlin;</span>
<span class="fc" id="L101">        this.rep_fireball = fireball;</span>
<span class="fc" id="L102">        this.rep_slime = slime;</span>
<span class="fc" id="L103">        this.rep_wizard_directions = wizard_directions;</span>
<span class="fc" id="L104">        this.rep_door = door;</span>
<span class="fc" id="L105">        this.rep_powerup = powerup;</span>
<span class="fc" id="L106">        this.rep_portal_status = portal_status;</span>
<span class="fc" id="L107">    }</span>
    
    /* 
    SECTION 3: SETTER AND GETTER FUNCTIONS
    */
<span class="fc" id="L112">    public void setStonewalls(ArrayList&lt;Stonewall&gt; stonewalls){ this.stonewalls = stonewalls;}</span>
<span class="fc" id="L113">    public void setBrickwalls(ArrayList&lt;Brickwall&gt; brickwalls){ this.brickwalls = brickwalls;}</span>
<span class="fc" id="L114">    public void setGremlins(ArrayList&lt;Gremlin&gt; gremlins){ this.gremlins = gremlins;}</span>
<span class="fc" id="L115">    public void setFireballs(ArrayList&lt;Fireball&gt; fireballs){ this.fireballs = fireballs;}</span>
<span class="fc" id="L116">    public void setSlimes(ArrayList&lt;Slime&gt; slimes){ this.slimes = slimes;}</span>
<span class="nc" id="L117">    public void setPortals(ArrayList&lt;Teleportal&gt; portals){ this.portals = portals;}</span>
<span class="fc" id="L118">    public void setWizard(Wizard wizard){ this.wizard = wizard;}</span>
<span class="fc" id="L119">    public void setDoor(Door exit){ this.door = exit;}</span>
<span class="nc" id="L120">    public void setPowerup(Powerup powerup){ this.powerup = powerup;}</span>

<span class="fc" id="L122">    public ArrayList&lt;Stonewall&gt; getStonewalls(){return this.stonewalls;}</span>
<span class="fc" id="L123">    public ArrayList&lt;Brickwall&gt; getBrickwalls(){ return this.brickwalls; }</span>
<span class="fc" id="L124">    public ArrayList&lt;Gremlin&gt; getGremlins(){ return this.gremlins;}</span>
<span class="fc" id="L125">    public ArrayList&lt;Fireball&gt; getFireballs(){ return this.fireballs;}</span>
<span class="fc" id="L126">    public ArrayList&lt;Slime&gt; getSlimes(){ return this.slimes;}</span>
<span class="nc" id="L127">    public ArrayList&lt;Teleportal&gt; getPortals(){ return this.portals;}</span>
<span class="fc" id="L128">    public Wizard getWizard(){ return this.wizard;}</span>
<span class="fc" id="L129">    public Door getDoor(){ return this.door;}</span>
<span class="nc" id="L130">    public Powerup getPowerup(){ return this.powerup;}</span>

    /* 
    SECTION 4: OTHER METHODS
    */
    public void loadMap(){
        /*
        NOTE:
            - This reads in the map text file using JSON.
         */
<span class="fc" id="L140">        MapParsing file_in = new MapParsing(this.levels_config.getJSONObject(this.current_level).get(&quot;layout&quot;).toString());</span>

        /*
        NOTE:
            - Reading in the maps from the layout text files via the JSON config
            and setting up all necessary assets for the level.
        */
<span class="fc" id="L147">        this.setStonewalls(file_in.parseStonewalls(this.rep_stonewall));</span>
<span class="fc" id="L148">        this.setBrickwalls(file_in.parseBrickwalls(this.rep_brickwall_stages));</span>
<span class="fc" id="L149">        this.setGremlins(file_in.parseGremlins(this.rep_gremlin));</span>
<span class="fc" id="L150">        this.setWizard(file_in.parseWizard(this.rep_wizard_directions));</span>
<span class="fc" id="L151">        this.setDoor(file_in.parseDoor(this.rep_door));</span>

        /*
        NOTE:
            - Making sure no projectiles remain from the previous 
            load and everything that needs to be reset gets reset.
         */
<span class="fc" id="L158">        this.fireballs = new ArrayList&lt;Fireball&gt;();</span>
<span class="fc" id="L159">        this.portals = new ArrayList&lt;Teleportal&gt;();</span>
<span class="fc" id="L160">        this.slimes = new ArrayList&lt;Slime&gt;();</span>
<span class="fc" id="L161">        this.powerup = null;</span>

<span class="fc" id="L163">        this.player_cooldown_frames = (int)(App.FPS * this.levels_config.getJSONObject(this.current_level).getFloat(&quot;wizard_cooldown&quot;));</span>
<span class="fc" id="L164">        this.gremlin_cooldown_frames = (int)(App.FPS * this.levels_config.getJSONObject(this.current_level).getFloat(&quot;enemy_cooldown&quot;));</span>
    
<span class="fc" id="L166">        this.initial_number_of_gremlins = this.gremlins.size();</span>

<span class="fc" id="L168">        this.powerup_spawn_counter = 0;</span>
<span class="fc" id="L169">        this.powerup_counter = 0;</span>
<span class="fc" id="L170">        this.powerup_duration = 7;</span>

<span class="fc" id="L172">        this.portal_effect_counter = 0;</span>

<span class="fc" id="L174">        this.gremlin_speed = 1;</span>
<span class="fc" id="L175">        this.player_speed = 2;</span>

        /* 
        NOTE:
            - Setting up the portals that can teleport the player and making sure it doesn't
            clash with any other object in the game. The number of portals is 
            set to 4 by default. Also, the distance between the portals is at least 4 tiles.
        */
<span class="fc" id="L183">        ArrayList&lt;Sprite&gt; all = new ArrayList&lt;Sprite&gt;();</span>

<span class="fc" id="L185">        all.addAll(this.stonewalls);</span>
<span class="fc" id="L186">        all.addAll(this.brickwalls);</span>
<span class="fc" id="L187">        all.addAll(this.gremlins);</span>
<span class="fc" id="L188">        all.add(this.wizard);</span>
<span class="fc" id="L189">        all.add(this.door);</span>

<span class="fc" id="L191">        int number_of_portals = 4;</span>
<span class="fc bfc" id="L192" title="All 2 branches covered.">        for(int i = 0; i &lt; number_of_portals; ){</span>
<span class="fc" id="L193">            Random rand = new Random();</span>
<span class="fc" id="L194">            boolean can_set_portal = true;</span>

<span class="fc" id="L196">            int portal_x = rand.nextInt(35) * App.SPRITESIZE;</span>
<span class="fc" id="L197">            int portal_y = rand.nextInt(32) * App.SPRITESIZE;</span>

            /*
            NOTE:
                - We don't want the portals to be set in the same coordinate as the walls.
             */
<span class="fc bfc" id="L203" title="All 2 branches covered.">            for(int j = 0; j &lt; all.size(); j++){</span>
<span class="fc bfc" id="L204" title="All 4 branches covered.">                if(portal_x == all.get(j).getX() &amp;&amp; portal_y == all.get(j).getY()){</span>
<span class="fc" id="L205">                    can_set_portal = false;</span>
<span class="fc" id="L206">                    break;</span>
                }
            }

            /*
            NOTE:
                - And we also don't want the portals to be too close to each other.
             */
<span class="fc" id="L214">            int minimum_distance = 4;</span>
<span class="fc bfc" id="L215" title="All 2 branches covered.">            for(int j = 0; j &lt; this.portals.size(); j++){</span>
<span class="fc bfc" id="L216" title="All 2 branches covered.">                if((this.portals.get(j).getX() &lt;= (portal_x + minimum_distance * App.SPRITESIZE)</span>
<span class="fc bfc" id="L217" title="All 2 branches covered.">                    &amp;&amp; this.portals.get(j).getX() &gt;= (portal_x - minimum_distance * App.SPRITESIZE))</span>
<span class="fc bfc" id="L218" title="All 2 branches covered.">                    || (this.portals.get(j).getY() &lt;= (portal_y + minimum_distance * App.SPRITESIZE)</span>
<span class="fc bfc" id="L219" title="All 2 branches covered.">                    &amp;&amp; this.portals.get(j).getY() &gt;= (portal_x - minimum_distance * App.SPRITESIZE))){</span>
<span class="fc" id="L220">                        can_set_portal = false;</span>
<span class="fc" id="L221">                        break;</span>
                }
            }

<span class="fc bfc" id="L225" title="All 2 branches covered.">            if(can_set_portal){</span>
<span class="fc" id="L226">                this.portals.add(new Teleportal(this.rep_portal_status, portal_x, portal_y));</span>
<span class="fc" id="L227">                i++;</span>
            }else{
                continue;
            }
<span class="fc" id="L231">        }</span>
<span class="fc" id="L232">    }</span>

    /*
    THE GAME LOGIC:
        - Otherwise known as the tick() function. But I just prefer to call it
        blit() to be different.
     */
<span class="fc" id="L239">    private boolean has_shot = false;</span>
    public void blit(int player_input, boolean released, boolean shoot){
        /* 
        RESTART/GAME OVER: 
            - Pressing keys to restart.
        */
<span class="pc bpc" id="L245" title="1 of 4 branches missed.">        if(this.lives &lt;= 0 || this.won){</span>
<span class="pc bpc" id="L246" title="1 of 2 branches missed.">            if(this.end_screen_counter &gt;= App.FPS * 2){</span>
<span class="nc bnc" id="L247" title="All 6 branches missed.">                if((player_input &gt;= 0 || player_input == ' ') &amp;&amp; !released){</span>
                
<span class="nc" id="L249">                    this.won = false;</span>
<span class="nc" id="L250">                    this.current_level = 0;</span>

<span class="nc" id="L252">                    this.lives = game_config.getInt(&quot;lives&quot;);</span>

<span class="nc" id="L254">                    this.end_screen_counter = 0;</span>
<span class="nc" id="L255">                    this.loadMap();</span>

                }
            }else{
<span class="fc" id="L259">                this.end_screen_counter++;</span>
            }
        }
        /*
        SECTION A:
            - This updates the list of walls for every frame.
        */
<span class="fc" id="L266">        this.walls = new ArrayList&lt;Sprite&gt;();</span>
<span class="fc" id="L267">        this.walls.addAll(this.brickwalls);</span>
<span class="fc" id="L268">        this.walls.addAll(this.stonewalls);</span>

        /*
        SECTION B:
            - The following is the logical sequence for the 
            player's movements. The whole point of this is to
            make sure the player moves within cells and is nowhere
            between the cells.
         */
<span class="fc bfc" id="L277" title="All 2 branches covered.">        boolean player_is_between_tiles = (this.wizard.getX() % App.SPRITESIZE != 0 </span>
<span class="fc bfc" id="L278" title="All 2 branches covered.">        || this.wizard.getY() % App.SPRITESIZE != 0);</span>

        /*
        SECTION C:
            - Executing the player's shooting logic and the fireball
            collision logic.
        */

<span class="fc bfc" id="L286" title="All 2 branches covered.">        if(this.has_shot){</span>
<span class="fc" id="L287">            this.player_cooldown_counter++;</span>
<span class="pc bpc" id="L288" title="1 of 2 branches missed.">            if(this.player_cooldown_counter &gt;= this.player_cooldown_frames){</span>
<span class="nc" id="L289">                this.player_cooldown_counter = 0;</span>
<span class="nc" id="L290">                this.has_shot = false;</span>
            }
        }

        /*
        NOTE:
            - Making sure there is an interval in between so
            the player doesn't shoot a continuous stream of fireballs.
         */
<span class="fc bfc" id="L299" title="All 4 branches covered.">        if(shoot &amp;&amp; this.player_cooldown_counter == 0){</span>
<span class="fc" id="L300">            this.wizard.shoot(this.fireballs, this.rep_fireball);</span>
<span class="fc" id="L301">            this.has_shot = true;</span>
        }
        
        /*
        NOTE:
            - The block below runs through each fireball
            and checks if they have collided with any given wall
        */
<span class="fc" id="L309">        int bwall_size_before_shoot = this.brickwalls.size();</span>
<span class="fc bfc" id="L310" title="All 2 branches covered.">        for(int index = 0; index &lt; this.fireballs.size(); index++){</span>
<span class="fc" id="L311">            this.fireballs.get(index).move();</span>
<span class="fc bfc" id="L312" title="All 2 branches covered.">            if(this.fireballs.get(index).collided(this.brickwalls, this.stonewalls, this.gremlins, this.slimes)){</span>
<span class="fc" id="L313">                this.fireballs.remove(index);</span>
            }
        }
<span class="fc bfc" id="L316" title="All 2 branches covered.">        for(int index = 0; index &lt; this.brickwalls.size(); index++){</span>
<span class="pc bpc" id="L317" title="1 of 2 branches missed.">            if(this.brickwalls.get(index).nextStage()){</span>
<span class="nc" id="L318">                this.brickwalls.remove(index);</span>
            }
        }
<span class="fc" id="L321">        int bwall_size_after_shoot = this.brickwalls.size();</span>

        /*
        SECTION D:
            - Executing the player's collision logic with the door, walls and powerups.
        */
<span class="pc bpc" id="L327" title="1 of 2 branches missed.">        if(bwall_size_before_shoot != bwall_size_after_shoot){</span>
            /*
            NOTE:
                - The Wizard method below exists because of a lack of
                design. The collision logic for the player should have been
                done discretely instead of continuously. My bad.

                - It's sort of a band-aid solution.
             */
<span class="nc" id="L336">            this.wizard.setRefresh(true);</span>
        }else{
<span class="fc" id="L338">            this.wizard.setRefresh(false);</span>
        }

<span class="fc" id="L341">        this.wizard.collided(this.walls);</span>
        
<span class="fc bfc" id="L343" title="All 2 branches covered.">        if(this.wizard.collided(this.door)){</span>
            /*
            NOTE:
                - If the player collides with a door then a new level
                gets set.
             */
<span class="fc" id="L349">            this.current_level++;</span>
<span class="fc bfc" id="L350" title="All 2 branches covered.">            if(this.current_level &gt;= this.levels_config.size()){</span>
<span class="fc" id="L351">                this.won = true;</span>
<span class="fc" id="L352">                return;</span>
            }else{
<span class="fc" id="L354">                this.loadMap();</span>
<span class="fc" id="L355">                return;</span>
            }
        }

<span class="fc bfc" id="L359" title="All 2 branches covered.">        if(this.powerup != null){</span>
            /*
            NOTE:
                - If the player collides with a powerup then all
                the gremlins are stopped for 10 seconds.
             */
<span class="fc bfc" id="L365" title="All 2 branches covered.">            if(this.wizard.collided(this.powerup)){</span>
<span class="fc" id="L366">                this.gremlin_speed = 0;</span>
<span class="fc" id="L367">                this.powerup = null;</span>

<span class="fc" id="L369">                this.powerup_counter = App.FPS * this.powerup_duration;</span>
<span class="fc" id="L370">                this.powerup_spawn_counter = 0;</span>
            }
        }

<span class="fc bfc" id="L374" title="All 2 branches covered.">        if(this.powerup_counter &gt; 0){</span>
<span class="fc" id="L375">            powerup_counter--;</span>
        }else{
<span class="fc" id="L377">            this.gremlin_speed = 1;</span>
        }

        /*
        SECTION E:
            - Executing the gremlins' collision logic with the walls and the player and
            random shooting of slimes.
         */
        /*
        NOTE:
            - This is the collision
         */
<span class="fc bfc" id="L389" title="All 2 branches covered.">        for(int index = 0; index &lt; this.gremlins.size(); index++){</span>
<span class="fc" id="L390">            gremlins.get(index).collided(this.walls);</span>

<span class="fc bfc" id="L392" title="All 2 branches covered.">            if(gremlins.get(index).collided(this.wizard)){</span>
<span class="fc" id="L393">                this.lives--;</span>
<span class="fc" id="L394">                this.loadMap();</span>
<span class="fc" id="L395">                return;</span>
            }

<span class="fc" id="L398">            gremlins.get(index).move(this.gremlin_speed);</span>
        }

        /*
        NOTE:
            - And this is the random shooting
         */

<span class="fc bfc" id="L406" title="All 2 branches covered.">        for(int index = 0; index &lt; this.gremlins.size(); index++){</span>
<span class="fc bfc" id="L407" title="All 2 branches covered.">            if(gremlins.get(index).cooldown_counter &gt;= gremlin_cooldown_frames){</span>
<span class="fc" id="L408">                gremlins.get(index).cooldown_counter = 0;</span>
            }

<span class="fc bfc" id="L411" title="All 2 branches covered.">            if(gremlins.get(index).cooldown_counter == 0){</span>
<span class="fc" id="L412">                gremlins.get(index).has_shot = false;</span>
<span class="fc" id="L413">                gremlins.get(index).cooldown_counter = 0;</span>

<span class="fc" id="L415">                Random rand = new Random();</span>
<span class="fc" id="L416">                int POOL = 7;</span>
                /*
                NOTE:
                    - The higher the value for `POOL`, the less
                    likely any given gremlin is going to shoot.
                 */
<span class="fc bfc" id="L422" title="All 2 branches covered.">                if(rand.nextInt(POOL) == 0){</span>
                    /*
                    NOTE:
                        - Setting the bound of the random variable high
                        so the probability of a gremlin shooting becomes lower.
                     */
<span class="fc" id="L428">                    gremlins.get(index).shoot(this.slimes, this.rep_slime);</span>
<span class="fc" id="L429">                    gremlins.get(index).has_shot = true;</span>
                }
            }

<span class="fc bfc" id="L433" title="All 2 branches covered.">            if(gremlins.get(index).has_shot){</span>
<span class="fc" id="L434">                gremlins.get(index).cooldown_counter++;</span>
            }

        }

<span class="fc bfc" id="L439" title="All 2 branches covered.">        for(int index = 0; index &lt; this.slimes.size(); index++){</span>
<span class="fc" id="L440">            this.slimes.get(index).move();</span>
<span class="fc bfc" id="L441" title="All 2 branches covered.">            if(this.slimes.get(index).collided(this.wizard)){</span>
                /*
                NOTE:
                    - We load the map again if the player
                    crashes into a slimeball. And the player
                    loses a life.
                 */
<span class="fc" id="L448">                this.lives--;</span>
<span class="fc" id="L449">                this.loadMap();</span>
<span class="fc" id="L450">                return;</span>
            }
<span class="fc bfc" id="L452" title="All 2 branches covered.">            if(this.slimes.get(index).collided(this.walls)){</span>
                /*
                NOTE:
                    - If the slime hits a wall then it's just
                    going to disappear.
                 */
<span class="fc" id="L458">                this.slimes.remove(index);</span>
            }
        }

        /*
        SECTION F:
            - Gremlins' random respawn.
        */
<span class="fc bfc" id="L466" title="All 2 branches covered.">        if(this.gremlins.size() &lt; this.initial_number_of_gremlins){</span>
            while(true){
<span class="fc" id="L468">                Random rand = new Random();</span>
                
<span class="fc" id="L470">                int respawn_x = rand.nextInt(35) * App.SPRITESIZE;</span>
<span class="fc" id="L471">                int respawn_y = rand.nextInt(32) * App.SPRITESIZE;</span>

<span class="fc" id="L473">                boolean can_respawn = true;</span>

<span class="fc bfc" id="L475" title="All 2 branches covered.">                for(int index = 0; index &lt; this.walls.size(); index++){</span>
                    /*
                    NOTE:
                        - This is checking to see if the gremlin is
                        being spawned within ten tiles radius from
                        the player.
                     */
<span class="fc" id="L482">                    boolean within_ten_tiles_radius = </span>
<span class="fc bfc" id="L483" title="All 2 branches covered.">                            ((respawn_x &lt; this.wizard.getX() + 10 * App.SPRITESIZE</span>
<span class="pc bpc" id="L484" title="1 of 2 branches missed.">                            &amp;&amp; respawn_x &gt; this.wizard.getX() - 10 * App.SPRITESIZE)</span>
<span class="fc bfc" id="L485" title="All 2 branches covered.">                            || (respawn_y &lt; this.wizard.getY() + 10 * App.SPRITESIZE</span>
<span class="pc bpc" id="L486" title="1 of 2 branches missed.">                            &amp;&amp; respawn_y &gt; this.wizard.getY() - 10 * App.SPRITESIZE));</span>

<span class="fc bfc" id="L488" title="All 2 branches covered.">                    if(respawn_x == this.walls.get(index).getX()</span>
<span class="fc bfc" id="L489" title="All 4 branches covered.">                    &amp;&amp; respawn_y == this.walls.get(index).getY()</span>
                    || within_ten_tiles_radius){
                        /*
                        NOTE:
                            - If the coordinates for the gremlin being 
                            respawned is colliding with a wall or is
                            within ten tiles radius of the player then
                            `can_respawn` is false and the whole loop runs 
                            again.
                         */
<span class="fc" id="L499">                        can_respawn = false;</span>
                    }
                }

<span class="fc bfc" id="L503" title="All 2 branches covered.">                if(can_respawn){</span>
<span class="fc" id="L504">                    this.gremlins.add(new Gremlin(this.rep_gremlin, respawn_x, respawn_y));</span>
<span class="fc" id="L505">                    break;</span>
                }
<span class="fc" id="L507">            }</span>
        }

        /*
        SECTION G
            - Making sure the player is moving within discrete tiles
            and not between tiles.
        */
<span class="fc bfc" id="L515" title="All 2 branches covered.">        if(player_is_between_tiles){</span>
<span class="fc" id="L516">            this.wizard.move(this.current_key_pressed, this.player_speed);</span>
        }else{
<span class="fc" id="L518">            this.current_key_pressed = player_input;</span>
<span class="fc bfc" id="L519" title="All 2 branches covered.">            if(released){</span>
<span class="fc" id="L520">                this.wizard.stop();</span>
            }else{
<span class="fc" id="L522">                this.wizard.move(this.current_key_pressed, this.player_speed);</span>
            }
        }

        /*
        SECTION H:
            - Powerup random spawning
         */

<span class="fc" id="L531">        Random rand = new Random();</span>
<span class="fc" id="L532">        boolean random_spawn = false;</span>
<span class="fc bfc" id="L533" title="All 2 branches covered.">        if(rand.nextInt(4) == 0){</span>
            /*
            NOTE:
                - One out of four chances of spawning a
                powerup.
             */
<span class="fc" id="L539">            random_spawn = true;</span>
        }
<span class="pc bpc" id="L541" title="1 of 6 branches missed.">        if(this.powerup_spawn_counter &gt; App.FPS * 10 &amp;&amp; random_spawn &amp;&amp; this.powerup == null){</span>
<span class="fc" id="L542">            this.powerup_spawn_counter = 0;</span>
            while(true){
<span class="fc" id="L544">                rand = new Random();</span>
                
<span class="fc" id="L546">                int spawn_x = rand.nextInt(35) * App.SPRITESIZE;</span>
<span class="fc" id="L547">                int spawn_y = rand.nextInt(32) * App.SPRITESIZE;</span>
    
<span class="fc" id="L549">                boolean can_spawn = true;</span>
    
<span class="fc bfc" id="L551" title="All 2 branches covered.">                for(int index = 0; index &lt; this.walls.size(); index++){</span>
<span class="fc bfc" id="L552" title="All 2 branches covered.">                    if(spawn_x == this.walls.get(index).getX()</span>
<span class="fc bfc" id="L553" title="All 2 branches covered.">                    &amp;&amp; spawn_y == this.walls.get(index).getY()){</span>
                        /*
                        NOTE:
                            - Spawning the powerups has the same logic
                            as spawning the gremlins except the powerups
                            can spawn within the player's ten-tile radius.
                         */
<span class="fc" id="L560">                        can_spawn = false;</span>
                    }
                }
    
<span class="fc bfc" id="L564" title="All 2 branches covered.">                if(can_spawn){</span>
<span class="fc" id="L565">                    this.powerup = new Powerup(rep_powerup, spawn_x, spawn_y);</span>
<span class="fc" id="L566">                    break;</span>
                }
<span class="fc" id="L568">            }</span>
        }else{
<span class="fc bfc" id="L570" title="All 2 branches covered.">            if(this.powerup_counter == 0){</span>
<span class="fc" id="L571">                this.powerup_spawn_counter++;</span>
            }
        }

        /*
        SECTION I: 
            - The extension where the player gets teleported to a random
            portal.
         */
<span class="pc bpc" id="L580" title="1 of 2 branches missed.">        if(this.portal_effect_counter &lt;= 0){</span>
<span class="fc bfc" id="L581" title="All 2 branches covered.">            for(int index = 0; index &lt; this.portals.size(); index++){</span>
                /*
                NOTE:
                    - This loop switches the image of the portals to the 
                    available representation.
               */
<span class="fc" id="L587">                this.portals.get(index).setAvailable();</span>
            }

<span class="fc bfc" id="L590" title="All 2 branches covered.">            for(int index = 0; index &lt; this.portals.size(); index++){</span>
                /*
                NOTE:
                    - This loop chooses a random portal for the player.
                */ 
<span class="pc bpc" id="L595" title="1 of 2 branches missed.">                if(this.portals.get(index).collided(this.wizard)){</span>
<span class="nc" id="L596">                    this.portal_effect_counter = App.FPS * 5;</span>

<span class="nc" id="L598">                    Random randport = new Random();</span>
<span class="nc" id="L599">                    int next_portal = randport.nextInt(this.portals.size());</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">                    while(next_portal == index){</span>
<span class="nc" id="L601">                        next_portal = randport.nextInt(this.portals.size());</span>
                    }

<span class="nc" id="L604">                    this.wizard.setCoordinate(this.portals.get(next_portal).getX(), this.portals.get(next_portal).getY());</span>

                    /*
                    NOTE:
                        - Making sure the player doesn't clip through any walls.
                     */
<span class="nc" id="L610">                    this.wizard.clearUnable();</span>
<span class="nc" id="L611">                    this.wizard.collided(this.walls);</span>

<span class="nc" id="L613">                    break;</span>
                }
            }
        }else{
<span class="nc bnc" id="L617" title="All 2 branches missed.">            for(int index = 0; index &lt; this.portals.size(); index++){</span>
                /*
                NOTE:
                    - And this switches the portals to a different
                    representation showing that it's not available for
                    use.
                 */
<span class="nc" id="L624">                this.portals.get(index).setUnavailable();</span>
            }
<span class="nc" id="L626">            this.portal_effect_counter--;</span>
        }

<span class="fc" id="L629">    }</span>

    public void displayLose(PApplet application){
        /*
        NOTE:
            - This is if the player loses.
            */
<span class="fc" id="L636">        application.textSize(45);</span>
<span class="fc" id="L637">        application.textAlign(application.CENTER);</span>
<span class="fc" id="L638">        application.text(&quot;You've lost miserably!&quot;, 720/2, 720/2 - 60);</span>
<span class="fc" id="L639">        application.textSize(25);</span>
<span class="fc" id="L640">        application.text(&quot;Press any key to restart.&quot;, 720/2, 720/2 + 40);</span>
<span class="fc" id="L641">        application.textSize(10);</span>
<span class="fc" id="L642">        application.text(&quot;Thank you for playing the game.\nMade by Tran Minh Cuong Vu (Jerry)&quot;, 720/2, 720/2 + 100);</span>
<span class="fc" id="L643">        application.fill(0, 0, 0);</span>

<span class="fc" id="L645">    }</span>

    public void displayWin(PApplet application){
        /*
        NOTE:
            - This happens when there are
            no more rounds to clear.
            */
<span class="fc" id="L653">        application.textSize(45);</span>
<span class="fc" id="L654">        application.textAlign(application.CENTER);</span>
<span class="fc" id="L655">        application.text(&quot;You've won!&quot;, 720/2, 720/2 - 60);</span>
<span class="fc" id="L656">        application.textSize(25);</span>
<span class="fc" id="L657">        application.text(&quot;Press any key to restart.&quot;, 720/2, 720/2 + 40);</span>
<span class="fc" id="L658">        application.textSize(10);</span>
<span class="fc" id="L659">        application.text(&quot;Thank you for playing the game.\nMade by Tran Minh Cuong Vu (Jerry)&quot;, 720/2, 720/2 + 100);</span>
<span class="fc" id="L660">        application.fill(0, 0, 0);</span>
<span class="fc" id="L661">    }</span>

    public void displayLives(PApplet application){

<span class="fc bfc" id="L665" title="All 2 branches covered.">        if(this.lives &gt; 5){</span>
            /*
            NOTE:
                - If the number of live is larger than 5 then we just
                display the number.
             */
<span class="fc" id="L671">            application.textSize(20);</span>
<span class="fc" id="L672">            application.textAlign(application.LEFT);</span>
<span class="fc" id="L673">            application.text(&quot;Lives: &quot; + ((Integer)this.lives).toString(), 20, 720 - App.BOTTOM_BAR/3 - 5);</span>
<span class="fc" id="L674">            application.fill(0, 0, 0);</span>
        }else{
            /*
            NOTE:
                - If it's equal to or less than 5 then we display
                the wizard icons.
             */
<span class="fc" id="L681">            application.textSize(20);</span>
<span class="fc" id="L682">            application.textAlign(application.LEFT);</span>
<span class="fc" id="L683">            application.text(&quot;Lives:&quot;, 20, 720 - App.BOTTOM_BAR/3 - 5);</span>
<span class="fc" id="L684">            application.fill(0, 0, 0);</span>
<span class="fc bfc" id="L685" title="All 2 branches covered.">            for(int index = 0; index &lt; this.lives; index++){</span>
<span class="fc" id="L686">                application.image(this.rep_wizard_directions[0], 60 + (index+1) * 25, 720 - 42);</span>
            }
        }
<span class="fc" id="L689">    }</span>

    public void displayLevel(PApplet application){
<span class="fc" id="L692">        String current_level_str = ((Integer)(this.current_level + 1)).toString();</span>
<span class="fc" id="L693">        application.textSize(15);</span>
<span class="fc" id="L694">        application.text(&quot;Level: &quot; + current_level_str, 620, 720 - App.BOTTOM_BAR/3 - 6);</span>
<span class="fc" id="L695">        application.fill(0, 0, 0);</span>
<span class="fc" id="L696">    }</span>

    public void displayCooldown(PApplet application){
        /*
        NOTE:
            - This first one is the original bar
         */
<span class="fc" id="L703">        application.fill(255, 255, 255);</span>
<span class="fc" id="L704">        application.rect(500, 685,  100, 5);</span>

        /*
        NOTE:
            - This second one is the bar that loads up.
         */
<span class="fc" id="L710">        application.fill(0, 0, 0);</span>
<span class="fc" id="L711">        application.rect(500, 685, (float)this.player_cooldown_counter * 100 / (float)(this.player_cooldown_frames), 5);</span>
<span class="fc" id="L712">    }</span>

    public void displayPowerup(PApplet application){
        /*
        NOTE:
            - The bar for remaining powerup.
        */
<span class="fc" id="L719">        application.fill(148,0,211);</span>
<span class="fc" id="L720">        application.rect(350, 685, (float)this.powerup_counter * 100 /(float)(App.FPS * this.powerup_duration), 5);</span>
<span class="fc" id="L721">        application.fill(0, 0, 0);</span>
<span class="fc" id="L722">    }</span>

    public void draw(PApplet application){
<span class="fc bfc" id="L725" title="All 2 branches covered.">        if(this.won){</span>
<span class="fc" id="L726">            this.displayWin(application);</span>
<span class="fc" id="L727">            return;</span>
        }

<span class="pc bpc" id="L730" title="1 of 2 branches missed.">        if(this.lives &lt;= 0){</span>
<span class="nc" id="L731">            this.displayLose(application);</span>
<span class="nc" id="L732">            return;</span>
        }

<span class="fc" id="L735">        this.displayLives(application);</span>
<span class="fc" id="L736">        this.displayCooldown(application);</span>
<span class="pc bpc" id="L737" title="1 of 2 branches missed.">        if(this.powerup_counter &gt; 0){</span>
<span class="nc" id="L738">            this.displayPowerup(application);</span>
        }
<span class="fc" id="L740">        this.displayLevel(application);</span>

        /*
        NOTE:
            - As there could be multiple sprites of 
            other types, we must loop through each of them
            in their respective lists in order to display 
            everything.
         */
        
<span class="fc" id="L750">        ArrayList&lt;Sprite&gt; all = new ArrayList&lt;Sprite&gt;();</span>

<span class="fc" id="L752">        all.addAll(this.stonewalls);</span>
<span class="fc" id="L753">        all.addAll(this.brickwalls);</span>
<span class="fc" id="L754">        all.addAll(this.portals);</span>
<span class="fc bfc" id="L755" title="All 2 branches covered.">        if(this.powerup != null){</span>
<span class="fc" id="L756">            all.add(this.powerup);</span>
        }
<span class="fc" id="L758">        all.add(this.door);</span>
<span class="fc" id="L759">        all.addAll(this.gremlins);</span>
<span class="fc" id="L760">        all.addAll(this.fireballs);</span>
<span class="fc" id="L761">        all.addAll(this.slimes);</span>
<span class="fc" id="L762">        all.add(this.wizard);</span>

<span class="fc bfc" id="L764" title="All 2 branches covered.">        for(int index = 0; index &lt; all.size(); index++){</span>
<span class="fc" id="L765">            all.get(index).draw(application);</span>
        }
<span class="fc" id="L767">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>